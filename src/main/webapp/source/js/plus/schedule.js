seajs.use(["$","bootstrap","underscore"],function(a,b,c){function d(a){var b=LunarCalendar.solarCalendar(a.begin.year,a.begin.month,0),d=c.filter(b.monthData,function(b,c){return c>=a.begin.day-1});if(a.begin.month==a.end.month)d=c.filter(b.monthData,function(b,c){return c>=a.begin.day-1&&c<=a.end.day-1});else{var e=LunarCalendar.solarCalendar(a.end.year,a.end.month,0),f=c.filter(e.monthData,function(b,c){return c<=a.end.day-1});d=d.concat(f)}return d}function e(b){var e=c.template(a("#j-schedule").html()),f=d(b),g=c.filter(f,function(a){return f[0].month==a.month}),h=32*g.length-80;f[0].month==f[27].month&&(h=1e4),a(".header-table").html(e({cal:f,mgl:h})).data(b)}function f(b,e){var f=c.template(a("#j-ads-list").html()),g=c.template(a("#j-ads-total").html()),h=a(".header-table").data(h),i=d(h);a("#j-table1-"+e).html(f({cal:i,ads:b,type:e})),a("#j-table2-"+e).html(g({ads:b,type:e}))}function g(b,d){var e=a("#timeViewItem_"+b.aId),g="",h=0;c.each(b.date,function(a){"3"==a.status&&(g+="<div><span>"+moment(a.begin,"X").format("YYYY-MM-DD")+"</span> ~ <span>"+moment(a.end,"X").format("YYYY-MM-DD")+"</span></div>",h+=(a.end-a.begin)/86400+1)}),e.find(".td_partialDate").addClass("hasDate"),e.find(".td_partialDate .td_date").html(g),a("#days_"+b.aId).html(h),d&&f(j,e.data("type"))}function h(b){if(2!=b.status){var d=c.template(a("#j-date-input").html()),e=a("#j-ad-date").find(".date-box-line").length;a("#j-ad-date").find("#j-add-date").parent().before(d({index:e,date:b}));var f={format:"yyyy-mm-dd",language:"zh-CN",startDate:new Date,autoclose:!0},g=function(b,c){var d=a(b),e=a(c);d.datepicker(f).on("changeDate",function(a){e.datepicker("setStartDate",new Date(moment(a.date).add(1,"days").format()))}),e.datepicker(f).on("changeDate",function(a){d.datepicker("setEndDate",new Date(moment(a.date).subtract(1,"days").format()))})};g("#j-begin-date-"+e,"#j-end-date-"+e)}}function i(b){var d=c.template(a("#j-modal-ads").html());a("#ads-list #ads"+b.tab).html(d({tab:b.tab})),a(".j-sel2").select2({formatNoMatches:"没有找到相关信息",formatSearching:"正在加载数据",formatLoadMore:"正在加载更多数据",formatAjaxError:"加载数据失败",minimumInputLength:1,ajax:{url:"https://api.github.com/search/repositories",dataType:"json",quietMillis:250,data:function(b,c){return b=a.trim(b),b=""===b?"default":b,{type:a(this).data("type"),q:b,page:c}},results:function(a,b){var c=10*b<a.total_count;return{results:a.items,more:c}},cache:!0},formatResult:function(a){return a.full_name},formatSelection:function(a){return a.full_name}}).on("change",function(a){console.log(a.val)}).on("select2-open",function(){a(this).select2("search"," ")}),a("#j-table-"+b.tab).dataTable({sPaginationType:"full_numbers",sDom:'rt<"clearfix datatablefoot"<"pull-left"l><"pull-left"i><"pull-right"p>>',aLengthMenu:[[10,20,30,50],[10,20,30,50]],oLanguage:{sLengthMenu:"每页显示 _MENU_ 条记录",sZeroRecords:"抱歉， 没有找到",sInfo:"&nbsp;&nbsp;&nbsp;共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",oPaginate:{sFirst:"首页",sPrevious:"前一页",sNext:"后一页",sLast:"尾页"}},sAjaxSource:"tabledatasource.json",aoColumns:[{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1}]}),a("#j-searchbtn-"+b.tab).click(function(){var c=a("#j-searchinput-"+b.tab).val();console.log("搜索",c)})}var j={};j={a1:{aId:1,title:"测试广告标题1",status:[{status:"half",pedding:0,begin:moment("2015-2-16","YYYY-M-D").format("X"),end:moment("2015-2-19","YYYY-M-D").format("X")}],clashDate:[],date:[{status:3,begin:moment("2015-2-20","YYYY-M-D").format("X"),end:moment("2015-2-25","YYYY-M-D").format("X")},{status:3,begin:moment("2015-2-28","YYYY-M-D").format("X"),end:moment("2015-3-2","YYYY-M-D").format("X")}]},a2:{aId:2,title:"测试广告标题2",status:[{status:"full",begin:moment("2015-2-28","YYYY-M-D").format("X"),end:moment("2015-3-1","YYYY-M-D").format("X")}],clashDate:[{begin:moment("2015-3-3","YYYY-M-D").format("X"),end:moment("2015-3-13","YYYY-M-D").format("X")}],date:[{status:3,begin:moment("2015-3-3","YYYY-M-D").format("X"),end:moment("2015-3-13","YYYY-M-D").format("X")}]},a3:{aId:3,title:"测试广告标题3",status:[{status:"full",begin:moment("2015-2-28","YYYY-M-D").format("X"),end:moment("2015-3-1","YYYY-M-D").format("X")}],clashDate:[],date:[{status:3,begin:moment("2015-2-27","YYYY-M-D").format("X"),end:moment("2015-2-28","YYYY-M-D").format("X")}]}};var k={format:"yyyy-mm-dd",language:"zh-CN",autoclose:!0},l=moment().add(1,"days"),m=moment().add(28,"days");a("#j-view-date").datepicker(k).datepicker("update",l.format("YYYY")+"-"+l.format("MM")+"-"+l.format("DD")),a("#j-view-date").on("changeDate",function(a){var b=moment(a.date),c=moment(a.date).add(27,"days");e({begin:{year:b.format("YYYY"),month:b.format("M"),day:b.format("D")},end:{year:c.format("YYYY"),month:c.format("M"),day:c.format("D")}}),f(j,2)}),e({begin:{year:l.format("YYYY"),month:l.format("M"),day:l.format("D")},end:{year:m.format("YYYY"),month:m.format("M"),day:m.format("D")}}),f(j,2),c.each(j,function(a){g(a)}),a(".btn-date").on("click",function(){var b=a(".header-table").data(),d=a(this),h=moment(b.begin.year+"-"+b.begin.month+"-"+b.begin.day,"YYYY-M-D");d.hasClass("nextDay")?h.add(1,"days"):d.hasClass("nextMonth")?h.add(1,"months"):d.hasClass("prevDay")?h.subtract(1,"days"):d.hasClass("prevMonth")&&h.subtract(1,"months");var i=moment(h.format("YYYY")+"-"+h.format("M")+"-"+h.format("D"),"YYYY-M-D");i.add(27,"days"),e({begin:{year:h.format("YYYY"),month:h.format("M"),day:h.format("D")},end:{year:i.format("YYYY"),month:i.format("M"),day:i.format("D")}}),f(j,2),c.each(j,function(a){g(a)})}),a(".ads-date").on("click",".st_free, .st_half",function(){if(!a(this).hasClass("not-allowed")){var b=a(this).find(".com_cb");b.hasClass("st3")||b.hasClass("st2")?b.removeClass("st2").removeClass("st3").addClass("st1").trigger({type:"change.status",cls:"st1",aId:a(this).parent().data("id")}):b.hasClass("st1")&&("1"==b.data("clash")?b.removeClass("st1").addClass("st2").trigger({type:"change.status",cls:"st3",aId:a(this).parent().data("id")}):b.removeClass("st1").addClass("st3").trigger({type:"change.status",cls:"st3",aId:a(this).parent().data("id")}))}}).on("mouseover",".adspace_title",function(){a(this).find(".icon_action").show()}).on("mouseout",".adspace_title",function(){a(this).find(".icon_action").hide()}).on("click",".icon_action",function(){var b=a(this),d=b.closest("tr").data("id"),e=a("#dateViewItem_"+d+", #timeViewItem_"+d);if(b.hasClass("icon_action_delete")){var f=a("#dateViewItem_"+d+" .tdheader");if(f.length)f.attr("rowspan",f.attr("rowspan")-1),e.next().prepend(f);else{var g=e.prevAll();f=a(a(".date-view-item")[0]).find(".tdheader"),g.find(".tdheader").attr("rowspan",f.attr("rowspan")-1)}e.remove(),delete j["a"+d],console.log(j);var h=e.data("type"),i=a(".j-ad-item-"+h);0==i.length&&a("#total-"+h).html('<td class="tdheader">'+(1==h?"售卖":"配送")+'</td><td colspan="10" class="text-left">无</td>')}else{var k=e.find(".st_free .com_cb,.st_half .com_cb");k.hasClass("st2")||k.hasClass("st3")?k.removeClass("st2").removeClass("st3").addClass("st1").trigger({type:"change.status",cls:"st1",aId:e.data("id")}):k.hasClass("st1")&&k.removeClass("st1").addClass("st3").trigger({type:"change.status",cls:"st3",aId:e.data("id")}),c.each(k,function(b){var c=a(b);c.hasClass("st3")&&"1"==c.data("clash")&&c.removeClass("st3").addClass("st2")})}}),a(".date-view").on("change.status",".com_cb",function(b){var d=a(b.target),e=d.data("date"),f=e-86400,h=parseInt(e)+86400,i=j["a"+b.aId];if("st3"==b.cls){var k=0,l=[];if(c.each(i.date,function(a,b){"3"==a.status&&(a.end==f?(a.end=e,l.push(b),k++):a.begin==h&&(a.begin=e,l.push(b),k++))}),0==k&&i.date.push({status:3,begin:e,end:e}),l.length>1){var m=i.date[l[0]],n=i.date[l[1]];m.begin==n.end?(n.end=m.end,i.date.splice(l[0],1)):(m.end=n.end,i.date.splice(l[1],1))}}else"st1"==b.cls&&c.each(i.date,function(a,b){e==a.begin&&e==a.end?i.date.splice(b,1):e==a.begin?a.begin=h:e==a.end?a.end=f:e>a.begin&&e<a.end&&(i.date.push({status:3,begin:h,end:a.end}),a.end=f)});g(i)}),a("#j-table2-1,#j-table2-2").on("mouseover",".hasDate",function(){a(this).find(".icon_modifyDate").show()}).on("mouseout",".hasDate",function(){a(this).find(".icon_modifyDate").hide()}),window.unitchange=function(b,c){var d=a(b),e=d.val(),f=a("#timeViewItem_"+c);f.find(".j-unit-title").html(a(b).text()),"4"==e?(a("#quantity_"+c).hide(),a("#selquantity_"+c).show(),a("#unit_"+c).text("轮播比例")):("1"==e||"2"==e)&&(a("#selquantity_"+c).hide(),a("#quantity_"+c).show(),a("#unit_"+c).text("1"==e?"展示数":"点击数"))},window.editPartialdate=function(b,d){var e=j["a"+d],f=c.template(a("#j-select-time").html());a("#j-ad-date").modal("show").data("aId",d),a("#j-ad-date").find(".modal-body").html(f({title:e.title})),c.each(e.date,function(b,c){0==c&&a("#j-ad-date").find(".date-input-item").remove(),h(b),a("#j-ad-date").find("#j-begin-date-0").closest(".date-input-item").find(".date-box-action").remove()})},a("#j-ad-date").on("click","#j-add-date",function(){h({begin:"",end:""})}).on("click",".j-remove-date",function(){a(this).closest(".date-input-item").remove()}),a("#j-date-submit").on("click",function(){var b=a("#j-ad-date").find(".date-box-line").length,d=a("#j-ad-date").data("aId"),e=j["a"+d].date,f=[];c.each(e,function(a){"3"!=a.status&&f.push(a)});for(var h=0;b>h;h++)f.push({status:3,begin:moment(a("#j-begin-date-"+h).val(),"YYYY-MM-DD").format("X"),end:moment(a("#j-end-date-"+h).val(),"YYYY-MM-DD").format("X")});j["a"+d].date=f,a("#j-ad-date").modal("hide"),g(j["a"+d],!0)}),window.showAds=function(b){a("#ads-list").modal("show").data("type",b).off("click.tabs").on("click.tabs",".nav-tabs a",function(){i({type:b,tab:a(this).parent().index()})}),i({type:b,tab:0})},window.saleguidecost=function(b){var c=a(b),d=c.val();d=""==d?0:parseFloat(c.val()),c.val(d.toFixed(3))},window.checkinput=function(b){var c=a(b);c.off("keypress").on("keypress",function(a){return console.log(a),46!=a.keyCode?a.keyCode>=46&&a.keyCode<=57:-1!=c.val().indexOf(".")?!1:void 0})}});